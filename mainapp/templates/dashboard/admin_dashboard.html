{% extends "base.html" %}
{% block content %}
<div class="flex min-h-screen w-full bg-gray-900">
    <!-- Sidebar -->
    <aside class="w-full max-w-xs bg-gray-800 p-8 rounded-r-2xl shadow-2xl flex flex-col items-center justify-start">
        <h2 class="text-3xl font-bold mb-8 text-center text-yellow-400 tracking-tight"><i class="fas fa-user-shield mr-2"></i>Admin Dashboard</h2>
        <!-- Stats Section -->
        <div class="grid grid-cols-1 gap-6 w-full mb-10" data-aos="fade-up">
            <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 text-black p-6 rounded-lg shadow-lg mb-2">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">Total Events</h3>
                    <i class="fas fa-calendar-alt text-2xl opacity-70"></i>
                </div>
                <p class="text-4xl font-bold mt-2">{{ total_events }}</p>
                <div class="w-full h-1 bg-black bg-opacity-20 mt-4 rounded-full overflow-hidden">
                    <div class="h-full bg-black bg-opacity-40 rounded-full" style="width: 75%"></div>
                </div>
            </div>
            <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 text-black p-6 rounded-lg shadow-lg mb-2">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">Total Bookings</h3>
                    <i class="fas fa-ticket-alt text-2xl opacity-70"></i>
                </div>
                <p class="text-4xl font-bold mt-2">{{ total_bookings }}</p>
                <div class="w-full h-1 bg-black bg-opacity-20 mt-4 rounded-full overflow-hidden">
                    <div class="h-full bg-black bg-opacity-40 rounded-full" style="width: 60%"></div>
                </div>
            </div>
            <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 text-black p-6 rounded-lg shadow-lg">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">Upcoming Events</h3>
                    <i class="fas fa-hourglass-half text-2xl opacity-70"></i>
                </div>
                <p class="text-4xl font-bold mt-2">{{ upcoming_events }}</p>
                <div class="w-full h-1 bg-black bg-opacity-20 mt-4 rounded-full overflow-hidden">
                    <div class="h-full bg-black bg-opacity-40 rounded-full" style="width: 40%"></div>
                </div>
            </div>
        </div>
    </aside>
    <!-- Main Content -->
    <main class="flex-1 flex flex-col items-center justify-start p-8">
        <!-- Manage Events Section -->
        <div class="w-full max-w-5xl mx-auto" data-aos="fade-up" data-aos-delay="100">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-yellow-400 mb-2 sm:mb-0"><i class="fas fa-calendar-check mr-2"></i>Manage Events</h3>
                <div class="flex flex-wrap items-center gap-2">
                    <input id="event-search" type="text" placeholder="Search events..." class="px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400" />
                    <button type="button" data-category="" class="filter-btn category-btn {% if not request.GET.category %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">All</button>
                    <button type="button" data-category="academic" class="filter-btn category-btn {% if request.GET.category == 'academic' %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">Academic</button>
                    <button type="button" data-category="cultural" class="filter-btn category-btn {% if request.GET.category == 'cultural' %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">Cultural</button>
                    <button type="button" data-category="sports" class="filter-btn category-btn {% if request.GET.category == 'sports' %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">Sports</button>
                    <button type="button" data-category="technical" class="filter-btn category-btn {% if request.GET.category == 'technical' %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">Technical</button>
                </div>
            </div>
            <div id="events-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
                {% include 'dashboard/partials/event_list.html' %}
            </div>
            <div class="mt-6 text-center">
                <a href="{% url 'create_event' %}" class="inline-block bg-yellow-400 text-black px-6 py-3 rounded-lg hover:bg-yellow-300 transition transform hover:-translate-y-1 hover:shadow-lg">
                    <i class="fas fa-plus-circle mr-2"></i>Create New Event
                </a>
            </div>
        </div>
        <!-- Manage Users Section -->
        <div class="mt-10 w-full max-w-5xl mx-auto" data-aos="fade-up" data-aos-delay="200">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-yellow-400 mb-2 sm:mb-0"><i class="fas fa-users-cog mr-2"></i>Manage Users</h3>
                <div class="flex items-center space-x-4">
                    <input id="user-search" type="text" placeholder="Search users..." class="px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400 mr-2" />
                    <button type="button" data-role="" class="filter-btn user-role-btn role-btn {% if not request.GET.role %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">All</button>
                    <button type="button" data-role="student" class="filter-btn user-role-btn role-btn {% if request.GET.role == 'student' %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">Student</button>
                    <button type="button" data-role="admin" class="filter-btn user-role-btn role-btn {% if request.GET.role == 'admin' %}bg-yellow-400 text-black{% else %}bg-gray-700 text-white{% endif %} px-4 py-2 rounded-lg hover:bg-yellow-300 hover:text-black transition-colors">Admin</button>
                </div>
            </div>
            <div id="users-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
                {% include 'dashboard/partials/user_list.html' %}
            </div>
        </div>
    </main>
</div>

        <!-- Help Section -->
        <div class="mt-10 text-center p-6 bg-gray-700 rounded-lg shadow-lg" data-aos="fade-up" data-aos-delay="300">
            <h3 class="text-xl font-semibold text-yellow-400 mb-2"><i class="fas fa-question-circle mr-2"></i>Need Help?</h3>
            <p class="text-gray-400 mb-4">If you need assistance managing events or users, our support team is here to help.</p>
            <a href="#" class="inline-block bg-yellow-400 text-black px-4 py-2 rounded-lg hover:bg-yellow-300 transition transform hover:-translate-y-1 hover:shadow-lg">
                <i class="fas fa-headset mr-1"></i>Contact Support
            </a>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const eventsContainer = document.querySelector('#events-grid');
    const usersContainer = document.querySelector('#users-grid');
    const categoryButtons = document.querySelectorAll('.category-btn');
    const roleButtons = document.querySelectorAll('.role-btn');

    function updateEvents(category, search) {
        const params = new URLSearchParams();
        if (category) params.append('category', category);
        if (search) params.append('search', search);
        fetch(`/filter-events/?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                eventsContainer.innerHTML = data.html;
                // Update button states
                categoryButtons.forEach(btn => {
                    if (btn.dataset.category === category) {
                        btn.classList.add('bg-yellow-400', 'text-black');
                        btn.classList.remove('bg-gray-700', 'text-white');
                    } else {
                        btn.classList.remove('bg-yellow-400', 'text-black');
                        btn.classList.add('bg-gray-700', 'text-white');
                    }
                });
            })
            .catch(error => console.error('Error:', error));
    }

    function updateUsers(role, search) {
        const params = new URLSearchParams();
        if (role) params.append('role', role);
        if (search) params.append('search', search);
        fetch(`/filter-users/?${params.toString()}`)
            .then(response => response.json())
            .then(data => {
                usersContainer.innerHTML = data.html;
                // Update button states
                roleButtons.forEach(btn => {
                    if (btn.dataset.role === role) {
                        btn.classList.add('bg-yellow-400', 'text-black');
                        btn.classList.remove('bg-gray-700', 'text-white');
                    } else {
                        btn.classList.remove('bg-yellow-400', 'text-black');
                        btn.classList.add('bg-gray-700', 'text-white');
                    }
                });
            })
            .catch(error => console.error('Error:', error));
    }

    let currentCategory = '';
    let currentEventSearch = '';
    let currentRole = '';
    let currentUserSearch = '';

    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            currentCategory = this.dataset.category;
            updateEvents(currentCategory, currentEventSearch);
        });
    });

    roleButtons.forEach(button => {
        button.addEventListener('click', function() {
            currentRole = this.dataset.role;
            updateUsers(currentRole, currentUserSearch);
        });
    });

    const eventSearchInput = document.getElementById('event-search');
    if (eventSearchInput) {
        eventSearchInput.addEventListener('input', function() {
            currentEventSearch = this.value;
            updateEvents(currentCategory, currentEventSearch);
        });
    }

    const userSearchInput = document.getElementById('user-search');
    if (userSearchInput) {
        userSearchInput.addEventListener('input', function() {
            currentUserSearch = this.value;
            updateUsers(currentRole, currentUserSearch);
        });
    }
});
</script>
{% endblock %}
